# Асинхронное выполнение задач через NATS

Асинхронное выполнение задач с использованием NATS и Queue Groups для балансировки нагрузки между несколькими обработчиками.

## Компоненты системы

1. **NATS сервер** - брокер сообщений, обеспечивающий коммуникацию между сервисами
2. **Publisher** - отправляет задачи в тему `jobs.create`
3. **Consumer** - подписывается на тему `jobs.create` через очередь `workers` и обрабатывает задачи
4. **Status Service** - отправляет запросы в тему `jobs.status` для получения информации о количестве обработанных задач

## Запуск проекта

`docker-compose up --build`

Publisher начнет отправлять задачи в тему jobs.create каждую секунду
Несколько Consumer'ов подпишутся на тему jobs.create через queue group workers
Задачи будут равномерно распределяться между Consumer'ами
Status Service будет периодически запрашивать информацию о количестве выполненных задач

Остановка:
`docker-compose down`

## Модель распределения сообщений
NATS использует модель publish-subscribe для обмена сообщениями. Когда мы используем Queue Groups:
- Несколько подписчиков могут объединяться в группу (в нашем случае workers)
- Когда сообщение публикуется в тему, только один из подписчиков в группе получит это сообщение
- NATS автоматически распределяет сообщения между всеми членами группы, обеспечивая балансировку нагрузки
Это позволяет горизонтально масштабировать обработчики задач, добавляя новые экземпляры Consumer'ов.

## Плюсы и минусы работы через NATS

### Плюсы:

- Простота - NATS имеет простой и понятный API
- Высокая производительность - обрабатывает миллионы сообщений в секунду
- Балансировка нагрузки - с помощью Queue Groups
- Масштабируемость - легко добавлять новые обработчики
- Низкая задержка - минимальные накладные расходы на передачу сообщений
- Отказоустойчивость - может работать в кластерном режиме

### Минусы:
- Гарантии доставки - базовая версия NATS не гарантирует доставку сообщений при сбоях (нужен NATS Streaming/Jetstream для этого)
- Сохранение состояния - базовый NATS не хранит сообщения (это решается с помощью Jetstream)
- Ограничения размера сообщения - по умолчанию 1MB
- Отсутствие встроенной фильтрации - нет встроенной фильтрации сообщений по содержимому

### Дополнительные возможности проекта
- Graceful Shutdown - все сервисы корректно завершают работу при получении сигналов SIGINT/SIGTERM
- Запрос статуса - периодический запрос количества обработанных задач
- Равномерное распределение - задачи равномерно распределяются между обработчиками благодаря Queue Groups
